<!DOCTYPE html>
<html>
<head>
    <style>
        #myCanvas{
            padding: 0;
            margin: auto;
            display: block;
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: currentColor;
        }
        body{
            background-color: currentColor;
            background-image: url("rain_blur.jpg");
            background-size: cover;
        }
        h1{
            color: red;
            text-align: center;
            font: "Arial";
        }
    </style>
    <title>IT202 - Project 3</title>
</head>
    <body>
        <h1>The Floor is Lava</h1>

        <canvas id="myCanvas" width="1200" height="600" style="border:1px solid white;">
        </canvas>  

        <script>
            var c = document.getElementById("myCanvas");
            var ctx = c.getContext("2d");

            var geo1 = {type:"enemy", x:-500, y:200, r:4, color:"red", speed:10, side:1};
            var geo2 = {type:"enemy", x:-500, y:200, r:9, color:"red", speed:8, side:1};
            var geo3 = {type:"enemy", x:-500, y:200, r:16, color:"red", speed:6, side:1};
            var geo4 = {type:"enemy", x:-500, y:200, r:25, color:"red", speed:4, side:1};
            var geo5 = {type:"enemy", x:-500, y:200, r:36, color:"red", speed:2, side:1};
            var geo6 = {type:"enemy", x:1300, y:400, r:4, color:"red", speed:10, side:-1};
            var geo7 = {type:"enemy", x:1300, y:400, r:9, color:"red", speed:8, side:-1};
            var geo8 = {type:"enemy", x:1300, y:400, r:16, color:"red", speed:6, side:-1};
            var geo9 = {type:"enemy", x:1300, y:400, r:25, color:"red", speed:4, side:-1};
            var geo10 = {type:"enemy", x:1300, y:400, r:36, color:"red", speed:2, side:-1};
            
            var geo00 = {type:"enemy", x:600, y:-45, r:25, color:"red", speed:4, side:0};
            var geo01 = {type:"enemy", x:600, y:-45, r:30, color:"red", speed:3, side:0};
            var geo02 = {type:"enemy", x:600, y:-45, r:35, color:"red", speed:2, side:0};
            var geo03 = {type:"enemy", x:600, y:-45, r:40, color:"red", speed:1, side:0};
            
            var player = {type: "player", x:600, y:300, r:10, color:"blue", speed:2};
            var gobjects = [geo1,geo2,geo3,geo4,geo5,geo6,geo7,geo8,geo9,geo10,geo00,geo01,geo02,geo03,player];

            
            //Seconds Counter
            //var game = {score: 10, state:"play"}
            var seconds = 0;
            var el = document.getElementById('seconds-counter');
            function incrementSeconds() {
                seconds += 1;
            }
            var cancel = setInterval(incrementSeconds, 1000);
            
            //Draw Objects
            function draw() {
                ctx.clearRect(0,0,c.width, c.height);
                
                //call drawscore
                drawScore();
                
                //Draw Enemies
                for (indx in gobjects) {
                    geo = gobjects[indx];

                    ctx.beginPath();
                    ctx.arc(geo.x, geo.y, geo.r, 0, 2 * Math.PI);

                    ctx.fillStyle = geo.color;
                    ctx.fill();
                    ctx.stroke();
    
                    //OBJECT COLLISION detection
                    if (geo.type !="player"){
                        if(collision(player, geo)){
                            if(geo.type == "enemy"){
                                //console.log(game.score)
                                alert("GET WREKT!\n You got a HIGH SCORE of: "+seconds);
                                document.location.reload();
                                clearInterval(interval);
                                //seconds-=1;
                            }
                        }
                    }

                    //update object movement
                    if (geo.side ==1){
                        if (geo.x-geo.r > c.width) {
                            geo.x = 0-geo.r;
                            geo.y = Math.random()*(c.height - 0);
                        }
                        if(geo.type != "player"){
                            geo.x+=geo.side*geo.speed;
                        }
                    }
                    if (seconds>10){
                        if (geo.side ==-1){
                            if (geo.x-geo.r < 0) {
                                geo.x = 1200+geo.r;
                                geo.y = Math.random()*(c.height - 0);
                            }
                            if(geo.type != "player"){
                                geo.x+=geo.side*geo.speed;
                            }
                        }
                    }
                    if (seconds>20){
                        if (geo.side ==0){
                            if (geo.y-geo.r >1200) {
                                geo.x = Math.random()*(c.width - 0);
                                geo.y = 0-geo.r;
                            }
                            if(geo.type != "player"){
                                geo.y+=geo.speed;
                            }
                        }
                    }
                }
                
                //Draw Player
                ctx.beginPath();
                ctx.arc(player.x, player.y, player.r, 0, 2 * Math.PI);
                ctx.fillStyle = player.color;
                ctx.fill();
                //ctx.stroke(); 
                window.requestAnimationFrame(draw);        
            }
            window.requestAnimationFrame(draw);
            
            //Prints score to canvas
            function drawScore() {
                ctx.font = "16px Arial";
                ctx.fillStyle = "white";
                ctx.fillText("Score: "+seconds, 8, 20);
            }
            
            //Collision is Enemy Boolean
            function collision(item1,item2){
                var result = false;
                
                var dx = item1.x - item2.x;
                var dy = item1.y - item2.y;
                var distance = Math.sqrt(dx*dx+dy*dy);
                if (distance < item1.r + item2.r){
                    result = true;
                }
                return result;
            }

            document.onkeydown=doKeyDown;
            function doKeyDown(evt){
                switch (evt.keyCode) {
                    case 38:  /* Up arrow was pressed */
                        if (player.y >=16){
                            player.y -= 20;
                        }
                        break;
                        case 40:  /* Down arrow was pressed */
                        if (player.y <=585){
                            player.y += 20;
                        }
                        break;
                        case 37:  /* Left arrow was pressed */
                        if (player.x - player.r >-5){
                            player.x -= 20;
                        }
                        break;
                        case 39:  /* Right arrow was pressed */
                        if (player.x + player.r < c.width){
                            player.x += 20;
                        }
                        break;
                    }
            }
        </script>
    </body>

</html>